id: 'CVE-2021-3156'
author: 'cekout'
name: 'sudoedit -s'
description: 'Check if sudo is vulnerable to sudoedit -s heap-based buffer overflow'
cve: 'CVE-2021-3156'
reference: 'https://nvd.nist.gov/vuln/detail/CVE-2021-3156'
cvssv3: 7.8
cvssv2: 0
severity: 'high'
tests:
  - command: "sudoedit -s '0123456789\\'"
    parsers:
      - parser_type: 'matcher'
        rule_type: 'word'
        condition: 'or'
        rules:
          - 'memory'
          - 'Error'
          - 'Backtrace'
          - 'malloc'
  - command: 'sudo --version'
    parsers:
      - parser_type: 'extractor'
        rule_type: 'regex'
        rules:
          - 'Sudo version .*\n'
      - parser_type: 'extractor'
        rule_type: 'regex'
        rules:
          - '(\d+\.)(\d+\.)(\.)?(\d)'       # simpler
          #- '(0|[1-9]\d*)\.(0|[1-9]d+\\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?'      #official versioning regex